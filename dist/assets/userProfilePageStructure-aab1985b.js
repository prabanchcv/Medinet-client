import{b as M,r as n,u as z,c as E,j as e,a as N,g as B,S as I,P as S,D as U,h as _,T as x,V as w,i as H,F as L,k as O,f as G,l as J}from"./index-6c023e7e.js";function V(){const t=M(s=>s.user.data),[c,r]=n.useState(""),[l,p]=n.useState(t.image),[i,o]=n.useState(t.userName),[u,m]=n.useState(""),[j,f]=n.useState(t.address),[v,C]=n.useState(t.contact),[b,y]=n.useState(t.gender),[k,D]=n.useState(t.age),P=localStorage.getItem("userToken"),g=z();n.useEffect(()=>{async function s(){P&&await N.get("http://localhost:3000/userData").then(a=>{a.data=="blocked"&&g("/login")})}s()});const T=E(),A=async s=>{s.preventDefault();const a=new FormData;a.append("name",i),a.append("age",k),a.append("images",l),a.append("address",j),a.append("contact",v),a.append("gender",b);try{N.put("http://localhost:3000/setProfile",a).then(h=>{h.data==="error"?m("Something went wrong"):h.data=="blocked"?(g("/login"),localStorage.removeItem("userToken")):(T(B(h.data)),m("Profile updated successfully"),setTimeout(()=>{m("")},4e3))})}catch(h){console.log(h)}};return e.jsx("div",{className:"row",children:e.jsxs("form",{className:"mx-auto w-75 setProfile border  shadow-lg",encType:"multipart/form-data",children:[e.jsx("div",{className:"text-center text-bold mb-3 mt-3",children:"SET PROFILE"}),e.jsxs("div",{className:"text-center  mb-3 mt-3",children:[c!=[]?e.jsx("img",{width:"150px",height:"200px",className:"text-wrap",src:c,alt:""}):t.image?e.jsx("img",{width:"150px",height:"200px",src:`http://localhost:3000/images/${t.image}`,alt:"profile"}):e.jsx("img",{width:"150px",height:"200px",src:"https://upload.wikimedia.org/wikipedia/commons/b/bc/Unknown_person.jpg",alt:"default"}),e.jsx("br",{}),e.jsx("input",{className:"form-control w-25 m-auto mt-3",type:"file",onChange:s=>{p(s.target.files[0]),r(URL.createObjectURL(s.target.files[0]))}}),u=="Profile updated successfully"?e.jsx("div",{className:"alert mt-3 alert-success",role:"alert",children:"Profile updated successfully"}):u?e.jsx("div",{className:"alert mt-3 alert-danger",role:"alert",children:u}):""]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6",children:[e.jsxs("label",{htmlFor:"name",children:["Name",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"name",value:i,onChange:s=>o(s.target.value),className:"form-control mb-2 form-control-sm",placeholder:"Name..."}),e.jsxs("label",{htmlFor:"age",children:["Age",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"age",value:k,onChange:s=>D(s.target.value),className:"form-control mb-2 form-control-sm",placeholder:"Age..."}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"",children:["Gender",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{type:"radio",value:"male",checked:b==="male",onChange:s=>y(s.target.value),className:"form-check-input",id:"male"}),e.jsx("label",{htmlFor:"male",className:"form-check-label",children:"Male"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{type:"radio",value:"female",checked:b==="female",onChange:s=>y(s.target.value),className:"form-check-input",id:"female"}),e.jsx("label",{htmlFor:"female",className:"form-check-label",children:"Female"})]}),e.jsx("br",{})]})}),e.jsxs("label",{htmlFor:"contact",children:["Contact",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"tel",id:"contact",value:v,onChange:s=>C(s.target.value),className:"form-control mb-2 form-control-sm",placeholder:"Contact..."})]}),e.jsxs("div",{className:"col-lg-6",children:[e.jsxs("label",{htmlFor:"address",children:["Address",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{id:"address",value:j,onChange:s=>f(s.target.value),className:"form-control h-25  mb-2 form-control-sm",placeholder:"Address..."}),"Created : ",t&&t.timeStamp]})]}),e.jsx("div",{className:"row mt-5",children:e.jsx("div",{className:"col-12 text-center",children:e.jsx("button",{className:"btn btn-outline-success mb-3",onClick:A,children:"Save"})})})]})})}const d=I.create({page:{backgroundColor:"white",padding:20},container:{display:"flex",flexDirection:"row"},column:{flex:1},label:{fontSize:16,fontWeight:"bold",marginBottom:5},value:{fontSize:16,marginBottom:5},prescription:{fontSize:20,fontWeight:"bold",marginBottom:5,marginTop:"20px"}});$.propTypes={data:S.object,user:S.object};function $({data:t,user:c}){return e.jsx(U,{children:e.jsxs(_,{size:"A4",style:d.page,children:[e.jsx("view",{children:e.jsx(x,{children:"MediNet"})}),e.jsxs(w,{style:d.container,children:[e.jsxs(w,{style:d.column,children:[e.jsxs(x,{style:d.label,children:["Name : ",c.userName]}),e.jsxs(x,{style:d.label,children:["Age : ",c.age]}),e.jsxs(x,{style:d.label,children:["Gender : ",c.gender]})]}),e.jsxs(w,{style:d.column,children:[e.jsxs(x,{style:d.label,children:["Doctor : ",t.docData[0].name]}),e.jsxs(x,{style:d.label,children:["Date : ",t.date]}),e.jsxs(x,{style:d.label,children:["Time : ",t.time]})]})]}),e.jsxs(w,{children:[e.jsx("hr",{}),e.jsx(x,{style:d.prescription,children:"Prescription"}),Object.entries(t.medicines)&&Object.entries(t.medicines).map((r,l)=>e.jsxs(x,{style:d.label,children:[r[0]&&r[0],":",r[1]&&r[1],e.jsx("br",{})]},l))]})]})})}R.propTypes={el:S.object,user:S.object};function R({el:t,user:c}){return e.jsx(e.Fragment,{children:e.jsx(H,{document:e.jsx($,{data:t,user:c}),fileName:"Prescription.pdf",children:({loading:r})=>r?"Loading document...":e.jsx("button",{className:"btn btn-success",children:e.jsx(L,{})})})})}function W(){const t=z(),c=M(o=>o.user.data),[r,l]=n.useState([]),p=localStorage.getItem("userToken"),i=n.useCallback(async()=>{await N.get("http://localhost:3000/prescriptions",{headers:{Authorization:`Brearer ${p}`}}).then(o=>{o.data=="blocked"?(t("/login"),localStorage.removeItem("userToken")):(console.log(o.data),l(o.data))})},[t,p]);return n.useEffect(()=>{i()},[i]),e.jsxs("div",{children:[e.jsx("h1",{children:"Prescriptions"}),r.length!=0&&r.map((o,u)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"card border  shadow-lg  p-3",children:e.jsxs("div",{className:"row ",children:[e.jsxs("div",{className:"col-md-4 ",children:[e.jsx("h4",{children:o.docData[0].name}),e.jsx("h6",{children:o.date}),e.jsx("h6",{children:o.time})]}),e.jsx("div",{className:"col-md-4",children:o.medicines&&Object.entries(o.medicines).map(([m,j])=>e.jsxs("div",{children:[e.jsx("b",{children:m}),":",j]},j.split(" ")[0]))}),e.jsx("div",{className:"col-md-4",children:o.medicines&&e.jsx(R,{el:o,user:c})})]})},u)}))]})}function q(){const[t,c]=n.useState(""),r=localStorage.getItem("userToken"),l=O(),p=z(),[i,o]=n.useState(null),u=M(s=>s.user.data.email),m=new Date,j=G(m,"dd-MM-yyyy"),f=m.getHours(),v=m.getMinutes(),C=f>=12?"PM":"AM",b=f%12===0?12:f%12,y=v.toString().padStart(2,"0"),k=`${b}.${y} ${C}`,D=n.useCallback(async s=>{console.log(s),await N.post(`http://localhost:3000/cancelAppoint/${s}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}).then(a=>{if(a.data=="blocked")history("/login"),localStorage.removeItem("userToken");else{const h=t.length!=0&&t.map(F=>F._id===s?(console.log(1),{...F,isCancelled:!0}):F);console.log(h),c(h)}})},[t,r]);n.useEffect(()=>{async function s(){await N.get("http://localhost:3000/appointments",{}).then(a=>{console.log(a.data),a.data=="blocked"?(localStorage.removeItem("userToken"),history("/login")):(c(a.data.appointments),o(a.data.user))})}s()},[r]);const P=n.useCallback(s=>{const a=s;l.emit("room:join",{email:u,room:a})},[l,u]),g=n.useCallback(s=>{const{room:a}=s;p(`/call/${a}`)},[p]);n.useEffect(()=>(l.on("room:join",g),()=>{l.off("room:join",g)}),[l,g]);const T=E(),A=(s,a)=>{if(i&&t&&a){l.emit("setup",i),l.emit("join-chat",s,i,a);const h=()=>{T(J(s)),p(`/chat/${a}`)};return l.on("chat-connected",h),()=>{l.off("chat-connected",h)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"appoints text-center p-3 m-5 border  shadow-lg ",children:[e.jsx("h2",{children:"Appointments"}),t?t.length!=0&&t.map(s=>e.jsx("div",{className:"appointCard text-center   border  shadow-lg  mt-3 p-3",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 text-start",children:[e.jsx("h4",{children:s.docData[0].name}),e.jsxs("h6",{className:"subText p-0 m-0",children:["Qualification:",s.docData[0].qualification]}),e.jsxs("h6",{className:"subText",children:["Gender:",s.docData[0].gender]}),e.jsxs("h6",{className:"subText",children:["Fees:",s.docData[0].fee]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("h6",{children:["Date : ",s.date]}),e.jsxs("h6",{children:["Time : ",s.time]})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs(e.Fragment,{children:[" ",e.jsx("br",{}),j>=s.date||s.time<k?"Expired":s.isAttended?"Attended":s.isCancelled?"cancelled":e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-danger text-white ps-2 pe-2 ",onClick:()=>D(s._id),style:{fontSize:"15px"},children:"Cancel"})," ",e.jsx("button",{style:{fontSize:"15px"},className:"btn ps-2 pe-2 btn-outline-success",onClick:()=>P(s._id+s.user),children:"Join"}),e.jsx("button",{style:{fontSize:"15px"},className:"btn ps-2 pe-2 btn-outline-success",onClick:()=>A(s._id,s.doctor),children:"Chat"})]})]})})]})},s._id)):e.jsx("p",{children:"No appointments found."})]})})}function K(){const[t,c]=n.useState(!0),[r,l]=n.useState(!1),[p,i]=n.useState(!1),o=()=>{c(!0),l(!1),i(!1)},u=()=>{c(!1),l(!0),i(!1)},m=()=>{c(!1),l(!1),i(!0)};return e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-md-3",children:e.jsx("div",{className:"row text-center",children:e.jsxs("div",{className:"list-group p-4  mt-5",children:[e.jsx("div",{className:"border  shadow-lg list-group-item btn btn-outline-success lists list-group-item-action text-wrap text-break",onClick:o,children:"Profile"}),e.jsx("br",{}),e.jsx("div",{className:"border  shadow-lg  list-group-item btn btn-outline-success lists list-group-item-action text-wrap text-break",onClick:u,children:"Appointments"}),e.jsx("br",{}),e.jsx("div",{className:"border  shadow-lg list-group-item btn btn-outline-success lists list-group-item-action text-wrap text-break",onClick:m,children:"Prescriptions"})]})})}),e.jsxs("div",{className:"col-12 col-md-9 bg-light",children:[t&&e.jsx(V,{}),r&&e.jsx(q,{}),p&&e.jsx(W,{})]})]})}export{K as default};
